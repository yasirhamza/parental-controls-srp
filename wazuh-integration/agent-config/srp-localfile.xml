<!--
  Wazuh Agent Configuration for Windows SRP Monitoring

  Add this to your Wazuh agent.conf (on the manager) or local ossec.conf (on the agent)
  Location: /var/ossec/etc/shared/default/agent.conf (manager centralized config)
           or C:\Program Files (x86)\ossec-agent\ossec.conf (local agent config)
-->
<agent_config os="Windows">
  <!-- Windows SRP logs - UTF-8 enriched by ExeMonitor.ps1 -ConvertAndEnrichSaferLog -->
  <localfile>
    <location>C:\ParentalControl\Logs\SAFER-UTF8.log</location>
    <log_format>syslog</log_format>
    <frequency>5</frequency>
  </localfile>

  <!-- Baseline sync events for CDB tracking -->
  <localfile>
    <location>C:\ParentalControl\Logs\baseline-sync.log</location>
    <log_format>syslog</log_format>
    <frequency>5</frequency>
  </localfile>

  <!-- CDB baseline upload - base64 encoded, runs hourly -->
  <!-- Triggers rule 100672 which can invoke active response to save CDB on manager -->
  <localfile>
    <log_format>full_command</log_format>
    <command>powershell -NoProfile -Command "$f=\"C:\ParentalControl\Data\srp_baseline.cdb\"; if(Test-Path $f){$b=[Convert]::ToBase64String([IO.File]::ReadAllBytes($f)); $c=(Get-Content $f).Count; Write-Output \"CDB_UPLOAD|entries:$c|data:$b\"}"</command>
    <frequency>3600</frequency>
    <alias>srp-cdb-upload</alias>
  </localfile>

  <!-- Windows Application Event Log for SRP blocked events -->
  <localfile>
    <location>Application</location>
    <log_format>eventchannel</log_format>
  </localfile>
</agent_config>
